<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Advanced Task Manager Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; }
    .glass { background: rgba(255,255,255,0.05); backdrop-filter: blur(6px); }
    .sidebar { min-width: 220px; max-width: 220px; }
    .not-present { color: #9ca3af; font-style: italic; }
    .active { background-color: rgba(255,255,255,0.1); }
  </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen flex">

<!-- Sidebar -->
<aside class="sidebar glass p-4 flex flex-col">
  <h1 class="text-2xl font-bold mb-6">Dashboard</h1>
  <nav class="flex flex-col gap-2">
    <button class="category-btn px-3 py-2 rounded hover:bg-slate-700 active" data-cat="war">WAR Tasks</button>
    <button class="category-btn px-3 py-2 rounded hover:bg-slate-700" data-cat="operations">Operations Tasks</button>
    <button class="category-btn px-3 py-2 rounded hover:bg-slate-700" data-cat="product">Product Tasks</button>
    <button class="category-btn px-3 py-2 rounded hover:bg-slate-700" data-cat="client">Client Tasks</button>
  </nav>
  <div class="mt-auto">
    <button id="exportBtn" class="w-full px-3 py-2 bg-emerald-500 text-slate-900 rounded font-semibold shadow hover:bg-emerald-400 mb-2">Export All</button>
    <button id="clearAllBtn" class="w-full px-3 py-2 bg-rose-600 text-white rounded shadow hover:bg-rose-500">Clear All</button>
  </div>
</aside>

<!-- Main Content -->
<main class="flex-1 p-6 space-y-6 overflow-auto">

  <!-- Form -->
  <section class="glass border border-slate-700 rounded p-4 shadow-lg">
    <h2 class="text-lg font-semibold mb-3">Add / Update Task</h2>
    <form id="taskForm" class="space-y-3">
      <div id="field-area"></div>
      <div class="flex gap-2 justify-end mt-4">
        <button type="button" id="resetBtn" class="px-4 py-2 bg-slate-700 rounded">Reset</button>
        <button type="submit" id="saveBtn" class="px-4 py-2 bg-indigo-600 rounded font-semibold">Save Task</button>
      </div>
    </form>
    <p class="text-sm text-slate-400 mt-2">Empty fields appear as <span class="not-present">Not Present</span>.</p>
  </section>

  <!-- Table -->
  <section class="glass border border-slate-700 rounded p-4 shadow-lg">
    <div class="flex items-center justify-between mb-3">
      <h2 class="text-lg font-semibold" id="tableTitle">WAR Tasks</h2>
      <div class="flex items-center gap-2">
        <input id="searchInput" placeholder="Search tasks..." class="px-3 py-2 bg-slate-800 rounded w-72" />
        <select id="filterEnv" class="px-3 py-2 bg-slate-800 rounded">
          <option value="">All Environments</option>
          <option value="UAT">UAT</option>
          <option value="Production">Production</option>
        </select>
      </div>
    </div>
    <div class="overflow-x-auto">
      <table class="w-full text-left table-auto" id="tasksTable"></table>
    </div>
  </section>

</main>

<script>
const NODE_NAMES = ['Compliance Card Brand & Mandate','Product Enhancement','Client Task','Infra Activity Support','Utility Enhancement','Resource Training','Management'];
const CATEGORY_KEYS = {war:'tasks_war',operations:'tasks_operations',product:'tasks_product',client:'tasks_client'};
let state = {category:'war', editing:null, data:{war:[],operations:[],product:[],client:[]}};
const $ = id=>document.getElementById(id);
function emptyIf(val){return val===undefined||val===null||String(val).trim()===''?'Not Present':val;}
function saveToStorage(){for(const cat in CATEGORY_KEYS){localStorage.setItem(CATEGORY_KEYS[cat],JSON.stringify(state.data[cat]||[]));}}
function loadFromStorage(){for(const cat in CATEGORY_KEYS){const raw=localStorage.getItem(CATEGORY_KEYS[cat]);try{state.data[cat]=raw?JSON.parse(raw):[];}catch(e){state.data[cat]=[];}}}
function elHTML(html){const div=document.createElement('div');div.innerHTML=html;return div.firstElementChild||div;}
function buildForm(){
  const area=$('field-area'); area.innerHTML=''; const cat=state.category;
  const commonFields=[{id:'clientName',label:'Client Name',type:'text'},{id:'env',label:'UAT / Production',type:'select',options:['UAT','Production']},{id:'taskDesc',label:'Task Description',type:'textarea'},{id:'resourceHours',label:cat==='product'?'Resource Daily Working Hours':'Resource Working Hours',type:'number'},{id:'tlHours',label:cat==='product'?'TL Daily Working Hours':'TL Working Hours',type:'number'},{id:'startDate',label:'Start Date',type:'date'},{id:'endDate',label:'End Date',type:'date'},{id:'basecampLink',label:'Basecamp/Email',type:'text'}];
  if(cat==='product'){
    area.appendChild(elHTML('<div class="mb-2"><label class="field-label">Node Name</label><select id="nodeName" class="mt-1 block w-full rounded bg-slate-800 px-3 py-2"></select></div>'));
    NODE_NAMES.forEach(n=>$('nodeName').add(new Option(n,n)));
    area.appendChild(elHTML('<div class="mb-2"><label class="field-label">Product Task</label><input id="productTask" class="mt-1 block w-full rounded bg-slate-800 px-3 py-2"/></div>'));
    area.appendChild(elHTML('<div class="mb-2"><label class="field-label">Resource Name</label><input id="resourceName" class="mt-1 block w-full rounded bg-slate-800 px-3 py-2"/></div>'));
    area.appendChild(elHTML('<div class="mb-2"><label class="field-label">TL Name</label><input id="tlName" class="mt-1 block w-full rounded bg-slate-800 px-3 py-2"/></div>'));
  }
  commonFields.forEach(f=>{
    if(cat==='product'&&(f.id==='clientName')) return;
    let html='';
    if(f.type==='select'){html=`<div class="mb-2"><label class="field-label">${f.label}</label><select id="${f.id}" class="mt-1 block w-full rounded bg-slate-800 px-3 py-2"><option value="">-- Select --</option>`;f.options.forEach(o=>html+=`<option value="${o}">${o}</option>`);html+='</select></div>';}
    else if(f.type==='textarea'){html=`<div class="mb-2"><label class="field-label">${f.label}</label><textarea id="${f.id}" rows="3" class="mt-1 block w-full rounded bg-slate-800 px-3 py-2"></textarea></div>`;}
    else{html=`<div class="mb-2"><label class="field-label">${f.label}</label><input id="${f.id}" type="${f.type}" class="mt-1 block w-full rounded bg-slate-800 px-3 py-2"/></div>`;}
    area.appendChild(elHTML(html));
  });
}

function renderTable(){
  const cat=state.category; $('tableTitle').textContent=({'war':'WAR Tasks','operations':'Operations Tasks','product':'Product Tasks','client':'Client Tasks'})[cat];
  const table=$('tasksTable'); table.innerHTML=''; const data=state.data[cat]||[];
  let headers=[]; if(cat==='war') headers=['#','Client Name','UAT/Production','Task Description','Resource Working Hours','TL Working Hours','Start Date','End Date','Basecamp/Email','Actions'];
  else if(cat==='operations') headers=['#','Client Name','UAT/Production','Task Description','Resource Daily Working Hours','TL Daily Working Hours','Start Date','End Date','Basecamp/Email','Actions'];
  else if(cat==='product') headers=['#','Node Name','Product Task','Task Description','Resource Name','TL Name','Resource Daily Working Hours','TL Daily Working Hours','Start Date','End Date','Actions'];
  else if(cat==='client') headers=['#','Client Name','Task Description','Resource Name','TL Name','Resource Daily Working Hours','TL Daily Working Hours','Start Date','End Date','Basecamp/Email','Actions'];
  const thead=document.createElement('thead'); const htr=document.createElement('tr'); headers.forEach(h=>{const th=document.createElement('th');th.className='px-3 py-2 text-sm text-slate-300';th.textContent=h;htr.appendChild(th);}); thead.appendChild(htr); table.appendChild(thead);
  const tbody=document.createElement('tbody'); let filtered=data.slice();
  const q=$('searchInput').value.trim().toLowerCase(); const envFilter=$('filterEnv').value;
  if(q) filtered=filtered.filter(row=>JSON.stringify(row).toLowerCase().includes(q));
  if(envFilter) filtered=filtered.filter(r=>(r.env||'').toLowerCase()===envFilter.toLowerCase());
  if(filtered.length===0){const tr=document.createElement('tr');const td=document.createElement('td');td.colSpan=headers.length;td.className='px-3 py-6 text-center text-slate-400';td.textContent='No tasks found.';tr.appendChild(td);tbody.appendChild(tr);}
  else filtered.forEach((row,i)=>{
    const tr=document.createElement('tr'); tr.className='border-t border-slate-800'; const cells=[];
    if(cat==='war') cells.push(i+1,emptyIf(row.clientName),emptyIf(row.env),emptyIf(row.taskDesc),emptyIf(row.resourceHours),emptyIf(row.tlHours),emptyIf(row.startDate),emptyIf(row.endDate),emptyIf(row.basecampLink));
    else if(cat==='operations') cells.push(i+1,emptyIf(row.clientName),emptyIf(row.env),emptyIf(row.taskDesc),emptyIf(row.resourceHours),emptyIf(row.tlHours),emptyIf(row.startDate),emptyIf(row.endDate),emptyIf(row.basecampLink));
    else if(cat==='product') cells.push(i+1,emptyIf(row.nodeName),emptyIf(row.productTask),emptyIf(row.taskDesc),emptyIf(row.resourceName),emptyIf(row.tlName),emptyIf(row.resourceHours),emptyIf(row.tlHours),emptyIf(row.startDate),emptyIf(row.endDate));
    else if(cat==='client') cells.push(i+1,emptyIf(row.clientName),emptyIf(row.taskDesc),emptyIf(row.resourceName),emptyIf(row.tlName),emptyIf(row.resourceHours),emptyIf(row.tlHours),emptyIf(row.startDate),emptyIf(row.endDate),emptyIf(row.basecampLink));
    cells.forEach(c=>{const td=document.createElement('td');td.className='px-3 py-2 align-top text-sm';td.innerHTML=c==='Not Present'?'<span class="not-present">Not Present</span>':c;tr.appendChild(td);});
    const actTd=document.createElement('td'); actTd.className='px-3 py-2';
    const editBtn=document.createElement('button'); editBtn.className='mr-2 px-2 py-1 bg-yellow-500 text-slate-900 rounded'; editBtn.textContent='Edit'; editBtn.onclick=()=>startEdit(i);
    const delBtn=document.createElement('button'); delBtn.className='px-2 py-1 bg-rose-600 text-white rounded'; delBtn.textContent='Delete'; delBtn.onclick=()=>deleteTask(i);
    actTd.appendChild(editBtn); actTd.appendChild(delBtn); tr.appendChild(actTd);
    tbody.appendChild(tr);
  });
  table.appendChild(tbody);
}

function collectForm(){
  const cat=state.category; const obj={};
  if(cat==='product'){obj.nodeName=$('nodeName').value; obj.productTask=$('productTask').value.trim(); obj.taskDesc=$('taskDesc').value.trim(); obj.resourceName=$('resourceName').value.trim(); obj.tlName=$('tlName').value.trim(); obj.resourceHours=$('resourceHours').value; obj.tlHours=$('tlHours').value; obj.startDate=$('startDate').value; obj.endDate=$('endDate').value;}
  else if(cat==='client'){obj.clientName=$('clientName').value.trim(); obj.taskDesc=$('taskDesc').value.trim(); obj.resourceName=$('resourceName')?$('resourceName').value.trim():''; obj.tlName=$('tlName')?$('tlName').value.trim():''; obj.resourceHours=$('resourceHours')?$('resourceHours').value:''; obj.tlHours=$('tlHours')?$('tlHours').value:''; obj.startDate=$('startDate').value; obj.endDate=$('endDate').value; obj.basecampLink=$('basecampLink').value.trim();}
  else{obj.clientName=$('clientName').value.trim(); obj.env=$('env').value; obj.taskDesc=$('taskDesc').value.trim(); obj.resourceHours=$('resourceHours').value; obj.tlHours=$('tlHours').value; obj.startDate=$('startDate').value; obj.endDate=$('endDate').value; obj.basecampLink=$('basecampLink').value.trim();}
  return obj;
}

function addOrUpdateTask(e){e.preventDefault();const cat=state.category;const obj=collectForm();if(state.editing!==null){state.data[cat][state.editing]=obj;state.editing=null;}else{state.data[cat].push(obj);} saveToStorage(); buildForm(); renderTable();}

function startEdit(index){state.editing=index; const cat=state.category; const row=state.data[cat][index]; buildForm();
  if(cat==='product'){$('nodeName').value=row.nodeName||''; $('productTask').value=row.productTask||''; $('taskDesc').value=row.taskDesc||''; $('resourceName').value=row.resourceName||''; $('tlName').value=row.tlName||''; $('resourceHours').value=row.resourceHours||''; $('tlHours').value=row.tlHours||''; $('startDate').value=row.startDate||''; $('endDate').value=row.endDate||'';}
  else if(cat==='client'){$('clientName').value=row.clientName||''; $('taskDesc').value=row.taskDesc||''; $('resourceName').value=row.resourceName||''; $('tlName').value=row.tlName||''; $('resourceHours').value=row.resourceHours||''; $('tlHours').value=row.tlHours||''; $('startDate').value=row.startDate||''; $('endDate').value=row.endDate||''; $('basecampLink').value=row.basecampLink||'';}
  else{$('clientName').value=row.clientName||''; $('env').value=row.env||''; $('taskDesc').value=row.taskDesc||''; $('resourceHours').value=row.resourceHours||''; $('tlHours').value=row.tlHours||''; $('startDate').value=row.startDate||''; $('endDate').value=row.endDate||''; $('basecampLink').value=row.basecampLink||'';}
  window.scrollTo({top:0,behavior:'smooth'});
}

function deleteTask(index){const cat=state.category;if(!confirm('Delete this task?')) return; state.data[cat].splice(index,1); saveToStorage(); renderTable();}
function resetForm(){state.editing=null; buildForm();}
function clearAll(){if(!confirm('This will remove ALL tasks from browser. Continue?')) return; for(const k of Object.values(CATEGORY_KEYS)) localStorage.removeItem(k); loadFromStorage(); buildForm(); renderTable();}

function exportAll(){
  const wb=XLSX.utils.book_new();
  for(const cat in CATEGORY_KEYS){
    const arr=state.data[cat]||[];
    if(arr.length===0){const ws=XLSX.utils.aoa_to_sheet([['No data']]); XLSX.utils.book_append_sheet(wb,ws,cat.substring(0,30)); continue;}
    const headers=Array.from(new Set(arr.flatMap(o=>Object.keys(o)))); const rows=[headers]; arr.forEach(o=>rows.push(headers.map(h=>o[h]||''))); const ws=XLSX.utils.aoa_to_sheet(rows); XLSX.utils.book_append_sheet(wb,ws,cat.substring(0,30));
  }
  XLSX.writeFile(wb,'task-manager-export.xlsx');
}

// Init
function init(){loadFromStorage(); buildForm(); renderTable();
  document.querySelectorAll('.category-btn').forEach(btn=>btn.addEventListener('click',e=>{
    document.querySelectorAll('.category-btn').forEach(b=>b.classList.remove('active'));
    e.target.classList.add('active'); state.category=e.target.dataset.cat; state.editing=null; buildForm(); renderTable();
  }));
  $('taskForm').addEventListener('submit',addOrUpdateTask);
  $('resetBtn').addEventListener('click',resetForm);
  $('clearAllBtn').addEventListener('click',clearAll);
  $('exportBtn').addEventListener('click',exportAll);
  $('searchInput').addEventListener('input',renderTable);
  $('filterEnv').addEventListener('change',renderTable);
}

init();
</script>

</body>
</html>
