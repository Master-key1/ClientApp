<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hotel Lookup</title>
  <style>
    body{font-family:Inter,Arial,Helvetica,sans-serif;background:#eef2f8;padding:24px;display:flex;justify-content:center}
    .container{width:100%;max-width:800px}
    .card{background:#fff;padding:24px;border-radius:14px;box-shadow:0 4px 14px rgba(0,0,0,0.08)}
    h2{margin-top:0;margin-bottom:12px}
    .row{display:flex;gap:8px;align-items:center}
    input{flex:1;padding:12px;border-radius:8px;border:1px solid #cbd5e1;font-size:15px}
    button{padding:12px 16px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
    .primary{background:#2563eb;color:#fff}
    .secondary{background:#e2e8f0;color:#1e293b}
    .result-card{margin-top:20px;padding:16px;border-radius:10px;background:#f8fafc;border:1px solid #e2e8f0}
    .label{font-weight:600}
    .history{margin-top:20px}
    .history-item{padding:10px;background:#fff;border-radius:8px;border:1px solid #e2e8f0;cursor:pointer;margin-bottom:8px}

    /* Spinner */
    #spinner{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;visibility:hidden}
    #spinner div{width:48px;height:48px;border:6px solid #fff;border-top-color:#2563eb;border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* Toast */
    #toast{position:fixed;top:20px;right:20px;background:#111827;color:#fff;padding:12px 18px;border-radius:8px;opacity:0;transition:opacity .3s}
    #toast.show{opacity:1}
  </style>
</head>
<body>
<div class="container">
  <div class="card">
    <h2>Hotel Details Lookup</h2>
    <div class="row">
      <input id="hotelId" placeholder="Enter hotel id (Aurus-794)">
      <button id="getBtn" class="primary">Search</button>
      <button id="testBtn" class="secondary">Demo</button>
    </div>

    <div id="result" class="result-card" style="display:none"></div>

    <div class="history">
      <h4>Recent Searches</h4>
      <div id="historyList"></div>
    </div>
  </div>
</div>

<div id="spinner"><div></div></div>
<div id="toast"></div>

<script>
  const BASE='http://localhost:8080/hotel/';
  const spinner=document.getElementById('spinner');
  const toast=document.getElementById('toast');
  const historyList=document.getElementById('historyList');

  function showSpinner(show){ spinner.style.visibility=show?'visible':'hidden'; }
  function showToast(msg){ toast.textContent=msg; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'),2000); }

  function addToHistory(id){
    let list=JSON.parse(localStorage.getItem('hotel_history')||'[]');
    if(!list.includes(id)){ list.unshift(id); if(list.length>5) list.pop(); localStorage.setItem('hotel_history',JSON.stringify(list)); }
    renderHistory();
  }

  function renderHistory(){
    historyList.innerHTML='';
    let list=JSON.parse(localStorage.getItem('hotel_history')||'[]');
    list.forEach(id=>{
      const div=document.createElement('div');
      div.className='history-item';
      div.textContent=id;
      div.onclick=()=>fetchHotel(id);
      historyList.appendChild(div);
    })
  }

  function renderHotel(obj){
    const result=document.getElementById('result');
    result.style.display='block';
    result.innerHTML=`
      <p><span class="label">Hotel ID:</span> ${obj.hotelId}</p>
      <p><span class="label">Hotel Name:</span> ${obj.hotelName}</p>
      <p><span class="label">Hotel Location:</span> ${obj.hotelLoc}</p>
      <p><span class="label">Booking Date:</span> ${obj.hotelBookDate}</p>
    `;
  }

  async function fetchHotel(id){
    if(!id){ showToast('Enter hotel id'); return; }
    showSpinner(true);
    try{
      const res=await fetch(BASE+id);
      const data=await res.json();
      renderHotel(data);
      addToHistory(id);
      showToast('Loaded successfully');
    }catch(e){ showToast('Failed to load'); }
    showSpinner(false);
  }

  document.getElementById('getBtn').onclick=()=>fetchHotel(document.getElementById('hotelId').value.trim());
  document.getElementById('testBtn').onclick=()=>fetchHotel('Aurus-794');

  renderHistory();
</script>
</body>
</html>
